-- Tests for file i/o

load system "io".

let filename = escape
"
global __retval__

import tempfile

new_file, filename = tempfile.mkstemp()

__retval__ = ('string', filename)
".

-- Open up the temporary file for appending
let file = fopen(filename, "a").

-- Write some content and close the file
fwriteln(file, "Asteroid!").
fwriteln(file, "Asteroid!!").
fwriteln(file, "Asteroid!!!").
fclose(file).

----------------------------------------------------

-- Open the file for reading
let file = fopen(filename, "r").

-- Assert that the content is correct

-- Seek to the next line
freadln(file)

-- Assert that the remaining content is the last two lines
assert fread(file) == "Asteroid!!Asteroid!!!".

-- Close the file
fclose(file).