------------------------------------------------------------------
-- Basic File I/O wrapper
------------------------------------------------------------------

------------------------------------------------------------------
function fopen
------------------------------------------------------------------
with (name:%string, mode:%string) do 

return escape
"
from asteroid_state import state
global __retval__

# Get variables
name_val = state.symbol_table.lookup_sym('name')
mode_val = state.symbol_table.lookup_sym('mode')

# Open file
f = open(name_val[1], mode_val[1])

__retval__ = ('foreign', f)
"
end
------------------------------------------------------------------


------------------------------------------------------------------
function freadline
------------------------------------------------------------------
with file do return escape
"
global __retval__
from asteroid_state import state
file_val = state.symbol_table.lookup_sym('file')

(FOREIGN, py_file) = file_val

line = py_file.readline()

__retval__ = ('string', line)
"
end
------------------------------------------------------------------

------------------------------------------------------------------
function fwrite
------------------------------------------------------------------
with (file, contents:%string) do escape
"
from asteroid_state import state
file_val = state.symbol_table.lookup_sym('file')
contents = state.symbol_table.lookup_sym('contents')

(FOREIGN, py_file) = file_val

py_file.write(contents[1])
"
end
------------------------------------------------------------------

------------------------------------------------------------------
function fclose
------------------------------------------------------------------
with file do escape
"
from asteroid_state import state
file_val = state.symbol_table.lookup_sym('file')

(FOREIGN, py_file) = file_val

py_file.close()
"
end